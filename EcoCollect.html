<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EcoCollect - Mega App v2</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
/* --- Pastel Animated Background --- */
@keyframes floatBG {0% {background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
body{background:linear-gradient(-45deg,#a8edea,#fed6e3,#fbc2eb,#a6c1ee);background-size:400% 400%;animation:floatBG 20s ease infinite;margin:0;padding-top:70px;font-family:'Segoe UI',Arial,sans-serif;color:#333;}
.navbar{background:linear-gradient(90deg,#a8edea,#fed6e3);box-shadow:0 3px 6px rgba(0,0,0,0.1);}
.navbar-brand{font-weight:700;color:#333!important;}
.card{background:#fff;border:none;border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,0.05);}
.btn-primary{background:linear-gradient(135deg,#a1c4fd,#c2e9fb);border:none;color:#333;font-weight:600;transition:all 0.3s ease;}
.btn-primary:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(0,0,0,0.2);}
.btn-secondary{background:linear-gradient(135deg,#fbc2eb,#a6c1ee);border:none;color:#333;font-weight:600;transition:all 0.3s ease;}
.btn-secondary:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(0,0,0,0.2);}
.upload-area{border:2px dashed #a1c4fd;background:#f0f9ff;padding:30px;border-radius:12px;text-align:center;cursor:pointer;transition:all 0.3s;}
.upload-area:hover{background:#e0f3ff;}
.quiz-option{padding:12px;border-radius:10px;background:#fef9f9;margin-bottom:10px;cursor:pointer;transition:all 0.2s;}
.quiz-option:hover{background:#f3f3f3;}
.quiz-option.correct{background:#d4f6d4;border:2px solid #4caf50;}
.quiz-option.incorrect{background:#fddcdc;border:2px solid #f44336;}
#dashboard{min-height:90vh;}
a{cursor:pointer;color:#0077b6;text-decoration:none;}
a:hover{text-decoration:underline;}
.progress-bar{transition:width 0.8s ease;}
.bounce{animation: bounce 1s infinite alternate;}
@keyframes bounce{0%{transform:translateY(0);}100%{transform:translateY(-5px);}}
/* Dashboard cards */
.stat-card{border-radius:12px;padding:20px;text-align:center;transition:all 0.3s;}
.stat-card:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(0,0,0,0.2);}
</style>
</head>
<body>

<nav class="navbar fixed-top">
  <div class="container-fluid">
    <span class="navbar-brand"><i class="fas fa-recycle"></i> EcoCollect</span>
    <button class="btn btn-sm btn-secondary" onclick="logout()">Logout</button>
  </div>
</nav>

<div class="container-fluid px-5">

<!-- Login Page -->
<div id="loginPage" class="row justify-content-center">
  <div class="col-md-5">
    <div class="card p-4 my-5">
      <h3 class="mb-3 text-center">Welcome to EcoCollect</h3>
      <input id="email" class="form-control mb-3" placeholder="you@eco.com">
      <input id="password" type="password" class="form-control mb-3" placeholder="password">
      <div class="d-flex justify-content-center gap-3">
        <button class="btn btn-primary" onclick="login()">Login</button>
        <button class="btn btn-secondary" onclick="register()">Register</button>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard -->
<div id="dashboard" style="display:none">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
      <div class="card p-3 h-100">
        <h5>Menu</h5>
        <div><a onclick="show('stats')">ğŸ“Š Dashboard</a></div>
        <div><a onclick="show('pickup')">ğŸ“¦ Schedule Pickup</a></div>
        <div><a onclick="show('guide')">ğŸ“– Eco Guide</a></div>
        <div><a onclick="show('quiz')">ğŸ“ Eco Quiz</a></div>
        <div><a onclick="show('funInteractions')">ğŸ® Fun Interaction</a></div>
        <div><a onclick="show('communitySection')">ğŸ‘¥ Community</a></div>
        <hr>
        <div id="userEmail" class="small text-muted"></div>
      </div>
    </div>

    <!-- Main content -->
    <div class="col-md-9">

      <!-- Dashboard Stats -->
      <div id="stats" class="card p-4 mb-4">
        <h4 class="mb-3">Your Recycling Dashboard</h4>
        <div class="row mb-3">
          <div class="col-md-3"><div class="stat-card bg-light"><strong>Items Recycled</strong><div id="itemsRecycled" style="font-size:28px;">0</div></div></div>
          <div class="col-md-3"><div class="stat-card bg-light"><strong>Total Weight (kg)</strong><div id="totalWeight" style="font-size:28px;">0</div></div></div>
          <div class="col-md-3"><div class="stat-card bg-light"><strong>Carbon Offset (kg)</strong><div id="carbonOffset" style="font-size:28px;">0</div></div></div>
          <div class="col-md-3"><div class="stat-card bg-light"><strong>XP Earned</strong><div id="xpEarned" style="font-size:28px;">0</div></div></div>
        </div>
        <div class="mb-3"><canvas id="monthlyChart" height="100"></canvas></div>
        <div class="row mb-3">
          <div class="col-md-6"><canvas id="materialsChart" height="150"></canvas></div>
          <div class="col-md-6"><canvas id="quizChart" height="150"></canvas></div>
        </div>
        <h5>Carbon Offset Progress</h5>
        <div class="progress mb-2" style="height:20px;">
          <div id="carbonProgress" class="progress-bar bg-success" style="width:0%">0%</div>
        </div>
        <div class="mt-2" id="impactEquivalents">ğŸŒ³ Trees saved: 0 | ğŸ’§ Water saved: 0L | âš¡ Energy saved: 0 kWh</div>
        <div class="mt-3"><p>Total pickups completed: <span id="totalPickups">0</span></p>
        <p>Badges earned: <span id="badgesEarned">None</span></p>
        <p>Consecutive engagement streak: <span id="streakDays">0</span> days</p></div>
      </div>

      <!-- Schedule Pickup -->
      <div id="pickup" class="card p-4 mb-4" style="display:none">
        <h4>Schedule a Pickup</h4>
        <input type="date" id="pickupDate" class="form-control mb-2">
        <input type="text" id="pickupLocation" class="form-control mb-2" placeholder="ğŸ“ Location">
        <select id="pickupType" class="form-control mb-2">
          <option value="">ğŸš— Pickup Type</option>
          <option>Doorstep</option><option>Drop-off</option>
        </select>
        <input type="time" id="pickupTime" class="form-control mb-2">
        <input type="text" id="pickupPhone" class="form-control mb-2" placeholder="ğŸ“ Phone">
        <div class="mb-2">
          <label><input type="checkbox" value="Plastics"> Plastics</label>
          <label class="ms-2"><input type="checkbox" value="Metal"> Metal</label>
          <label class="ms-2"><input type="checkbox" value="Paper"> Paper</label>
        </div>
        <textarea id="pickupNotes" class="form-control mb-2" placeholder="Notes (optional)"></textarea>
        <button class="btn btn-primary" onclick="schedulePickup()">Save Pickup</button>

        <h5 class="mt-4">ğŸ“Œ Pickup Tracker</h5>
        <table class="table table-bordered table-striped mt-2">
          <thead class="table-light">
            <tr>
              <th>Date</th><th>Time</th><th>Location</th><th>Type</th><th>Phone</th><th>Materials</th><th>Notes</th><th>Status</th><th>Action</th>
            </tr>
          </thead>
          <tbody id="pickupTracker"></tbody>
        </table>
      </div>

      <!-- Eco Guide -->
      <div id="guide" class="card p-4 mb-4" style="display:none">
        <h4>ğŸ“– Eco Guide</h4>
        <div id="guideCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner text-center p-4" style="font-size:18px;">
            <div class="carousel-item active">ğŸŒ± Reduce waste by using reusable bags, bottles, and containers.</div>
            <div class="carousel-item">â™»ï¸ Separate recyclables properly: Paper, Plastic, Metal, Glass.</div>
            <div class="carousel-item">ğŸ’§ Conserve water: turn off taps, collect rainwater, fix leaks.</div>
            <div class="carousel-item">âš¡ Save energy: LED bulbs, switch off devices, use renewable energy.</div>
            <div class="carousel-item">ğŸ‚ Compost food scraps to reduce landfill waste.</div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#guideCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#guideCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>

      <!-- Eco Quiz -->
      <div id="quiz" class="card p-4 mb-4" style="display:none">
        <h4>ğŸ“ Eco Quiz</h4>
        <div id="questionArea">
          <h6 id="questionNumber"></h6>
          <div id="questionText"></div>
          <div id="options" class="mt-2"></div>
          <button id="nextQ" class="btn btn-primary mt-3" onclick="nextQuestion()" disabled>Next</button>
          <div id="quizStreak" class="mt-2"></div>
        </div>
        <div id="quizDone" style="display:none" class="text-center">
          <h3>All Done!</h3>
          <div id="quizScore" style="font-size:28px;color:#0077b6"></div>
          <button class="btn btn-secondary mt-2" onclick="startQuiz()">Play Again</button>
        </div>
      </div>

      <!-- Fun Interactions -->
      <div id="funInteractions" class="card p-4 mb-4" style="display:none">
        <h4>ğŸ® Recycling Drag & Drop Game</h4>
        <div class="mb-3">
          <div class="d-flex gap-3">
            <div id="itemsPool" class="p-3 flex-fill bg-light rounded" style="min-height:150px;">Drag items here</div>
            <div id="bins" class="d-flex flex-column gap-2">
              <div id="recyclableBin" class="p-3 bg-success text-white rounded" style="min-height:60px;">â™»ï¸ Recyclable</div>
              <div id="nonRecyclableBin" class="p-3 bg-danger text-white rounded" style="min-height:60px;">ğŸš« Not Recyclable</div>
            </div>
          </div>
          <div id="gameScore" class="mt-2"></div>
        </div>
      </div>

      <!-- Community Section -->
      <div id="communitySection" class="card p-4 mb-4" style="display:none">
        <h4>ğŸ‘¥ Community</h4>
        <div class="mb-3">
          <h5>ğŸ… Leaderboard</h5>
          <ul id="communityLeaderboard" class="list-group"></ul>
        </div>
        <div class="mb-3">
          <h5>ğŸŒ Community Goal</h5>
          <div>Total Carbon Offset This Month: <span id="communityCarbon">0</span> kg</div>
          <div class="progress mt-1" style="height:15px; border-radius:10px;">
            <div id="communityGoalProgress" class="progress-bar"></div>
          </div>
        </div>
        <div>
          <h5>âœï¸ Make a Pledge</h5>
          <input id="pledgeInput" class="form-control mb-2" placeholder="I will carry my own bag">
          <button class="btn btn-primary mb-2" onclick="addPledge()">Commit</button>
          <ul id="pledgeList" class="list-group"></ul>
        </div>
      </div>

    </div>
  </div>
</div>
</div>

<audio id="chime" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
// ===== Local Storage Backend =====
let currentUser=null;
let users=JSON.parse(localStorage.getItem('users')||'[]');
let pickups=JSON.parse(localStorage.getItem('pickups')||'[]');
let pledges=JSON.parse(localStorage.getItem('pledges')||'[]');
let xp=0;
function save(){localStorage.setItem('users',JSON.stringify(users));localStorage.setItem('pickups',JSON.stringify(pickups));localStorage.setItem('pledges',JSON.stringify(pledges));}

// ===== Auth =====
function register(){let e=email.value,p=password.value;if(users.find(u=>u.email===e))return alert("User exists");users.push({email:e,password:p});save();alert("Registered! Please login.");}
function login(){let e=email.value,p=password.value,u=users.find(u=>u.email===e&&u.password===p);if(!u)return alert("Invalid");currentUser=u;loginPage.style.display='none';dashboard.style.display='block';userEmail.innerText=e;loadStats();loadPickupTracker();}
function logout(){currentUser=null;dashboard.style.display='none';loginPage.style.display='block';}

// ===== Navigation =====
function show(id){
['stats','pickup','guide','quiz','funInteractions','communitySection'].forEach(x=>document.getElementById(x).style.display='none');
document.getElementById(id).style.display='block';
if(id==='stats') loadStats();
if(id==='pickup') loadPickupTracker();
if(id==='quiz') startQuiz();
if(id==='funInteractions') initSortingGame();
if(id==='communitySection'){updateCommunityLeaderboard();updateCommunityGoal();renderPledges();}
}

// ===== Dashboard =====
function loadStats(){
  let mine=pickups.filter(p=>p.user===currentUser.email);
  let items=0; mine.forEach(p=>items+=p.materials.length);
  let weight=items*5,carbon=weight*0.85;
  itemsRecycled.innerText=items*10;
  totalWeight.innerText=weight;
  carbonOffset.innerText=Math.round(carbon);
  xpEarned.innerText=xp;

  // Monthly Bar Chart
  const ctx=monthlyChart.getContext('2d');
  if(window.monthlyChartObj) window.monthlyChartObj.destroy();
  window.monthlyChartObj=new Chart(ctx,{
    type:'bar',
    data:{labels:["Jan","Feb","Mar","Apr"],datasets:[{data:[items,items+3,items+5,items+2],backgroundColor:"#a1c4fd"}]},
    options:{plugins:{legend:{display:false}}}
  });

  // Materials Pie Chart
  const mats={Plastics:0,Metal:0,Paper:0};
  mine.forEach(p=>p.materials.forEach(m=>mats[m]++));
  const ctx2=materialsChart.getContext('2d');
  if(window.materialsChartObj) window.materialsChartObj.destroy();
  window.materialsChartObj=new Chart(ctx2,{
    type:'pie',
    data:{labels:Object.keys(mats),datasets:[{data:Object.values(mats),backgroundColor:["#a1c4fd","#fbc2eb","#c2e9fb"]}]}
  });

  // Quiz Doughnut placeholder
  const ctx3=quizChart.getContext('2d');
  if(window.quizChartObj) window.quizChartObj.destroy();
  window.quizChartObj=new Chart(ctx3,{type:'doughnut',data:{labels:["Score","Remaining"],datasets:[{data:[0,10],backgroundColor:["#a1c4fd","#fbc2eb"]}]}});

  // Carbon Progress
  let goal=100; let percent=Math.min(100,Math.round(carbon/goal*100));
  carbonProgress.style.width=percent+'%';
  carbonProgress.innerText=percent+'%';

  // Impact equivalents
  impactEquivalents.innerText=`ğŸŒ³ Trees saved: ${Math.floor(items/10)} | ğŸ’§ Water saved: ${items*5}L | âš¡ Energy saved: ${items*2} kWh`;

  // Stats paragraphs
  totalPickups.innerText=mine.length;
  streakDays.innerText=7; // example
  badgesEarned.innerText="Plastic Buster, Paper Saver";
}

// ===== Schedule Pickup =====
function schedulePickup(){
  let d=pickupDate.value,l=pickupLocation.value,t=pickupType.value,pt=pickupTime.value,pn=pickupPhone.value;
  let mats=[...document.querySelectorAll('#pickup input[type=checkbox]:checked')].map(i=>i.value);
  if(!d||!l||!t||!pt||!pn||mats.length===0) return alert("Fill all fields!");
  pickups.push({user:currentUser.email,date:d,location:l,pickupType:t,time:pt,phone:pn,materials:mats,notes:pickupNotes.value,status:"Scheduled"});
  save();alert("Pickup saved!");playChime();loadPickupTracker();show('pickup');
}
function loadPickupTracker(){
  pickupTracker.innerHTML="";
  pickups.filter(p=>p.user===currentUser.email).forEach((p,i)=>{
    let row=document.createElement('tr');
    row.innerHTML=`<td>${p.date}</td><td>${p.time}</td><td>${p.location}</td><td>${p.pickupType}</td>
    <td>${p.phone}</td><td>${p.materials.join(", ")}</td><td>${p.notes}</td>
    <td>${p.status}</td>
    <td><button class="btn btn-sm btn-success" onclick="markCompleted(${i})">Complete</button></td>`;
    pickupTracker.appendChild(row);
  });
}
function markCompleted(idx){pickups[idx].status="Completed";save();loadPickupTracker();}

// ===== Eco Quiz =====
const qs=[
{q:"Which is NOT recyclable?",opts:["Can","Jar","Soiled Pizza box"],a:2},
{q:"Aluminum can be recycled?",opts:["Once","Infinitely"],a:1},
{q:"Paper can be recycled?",opts:["Yes","No"],a:0},
{q:"Plastic bags are?",opts:["Recyclable","Not Recyclable"],a:1},
{q:"Glass bottles?",opts:["Yes","No"],a:0},
{q:"Composting food scraps?",opts:["Yes","No"],a:0}
];
let qi=0,score=0,quizStreak=0;
function startQuiz(){qi=0;score=0;quizStreak=0;quizDone.style.display='none';questionArea.style.display='block';loadQ();}
function loadQ(){let q=qs[qi];questionNumber.innerText="Q "+(qi+1)+"/"+qs.length;questionText.innerText=q.q;options.innerHTML='';q.opts.forEach((o,i)=>{let d=document.createElement('div');d.className='quiz-option';d.innerText=o;d.onclick=()=>selectOpt(d,i===q.a);options.appendChild(d);});nextQ.disabled=true;}
function selectOpt(d,ok){document.querySelectorAll('.quiz-option').forEach(x=>x.onclick=null);if(ok){d.classList.add('correct');score++;quizStreak++;}else{d.classList.add('incorrect');quizStreak=0;}quizStreakEl=document.getElementById('quizStreak');quizStreakEl.innerText=`Streak: ${quizStreak}`;nextQ.disabled=false;}
function nextQuestion(){qi++;if(qi<qs.length)loadQ();else finishQuiz();}
function finishQuiz(){questionArea.style.display='none';quizDone.style.display='block';quizScore.innerText=score+"/"+qs.length;addXP(score*2);loadStats();confettiEffect();playChime();}

// ===== Fun Interaction Drag & Drop Game =====
let gameScoreCount=0;
function initSortingGame(){
  itemsPool.innerHTML="";
  gameScore.innerText="Score: 0";
  let items=["Plastic Bottle","Glass Jar","Aluminum Can","Pizza Box"];
  items.forEach(it=>{
    let d=document.createElement('div');d.innerText=it;d.draggable=true;d.style.padding="6px";d.style.margin="4px";d.style.border="1px solid #333";d.style.borderRadius="5px";d.style.background="#f3f3f3";
    d.ondragstart=(e)=>{e.dataTransfer.setData("text",it);};
    itemsPool.appendChild(d);
  });
  [recyclableBin,nonRecyclableBin].forEach(bin=>{
    bin.ondragover=(e)=>e.preventDefault();
    bin.ondrop=(e)=>{
      let data=e.dataTransfer.getData("text");
      if(bin.id=="recyclableBin"&&["Plastic Bottle","Glass Jar","Aluminum Can"].includes(data)){gameScoreCount+=1;}
      else if(bin.id=="nonRecyclableBin"&&data=="Pizza Box"){gameScoreCount+=1;}
      else{gameScoreCount-=1;}
      gameScore.innerText="Score: "+gameScoreCount;
    };
  });
}

// ===== Community =====
function updateCommunityLeaderboard(){
  let leaderboard=users.map(u=>{let userPickups=pickups.filter(p=>p.user===u.email);let items=userPickups.reduce((a,b)=>a+b.materials.length,0)*10;return {email:u.email,items};}).sort((a,b)=>b.items-a.items);
  communityLeaderboard.innerHTML=leaderboard.map((u,i)=>`<li class="list-group-item">${i+1}. ${u.email} - ${u.items} items â™»ï¸</li>`).join('');
}
function updateCommunityGoal(){let totalCarbon=pickups.reduce((sum,p)=>sum+(p.materials.length*5*0.85),0);let goal=100;let percent=Math.min(100,Math.round(totalCarbon/goal*100));communityCarbon.innerText=Math.round(totalCarbon);communityGoalProgress.style.width=percent+'%';communityGoalProgress.innerText=percent+'%';}
function addPledge(){let p=pledgeInput.value.trim();if(!p) return alert("Enter a pledge!");pledges.push({user:currentUser.email,pledge:p});save();pledgeInput.value="";renderPledges();}
function renderPledges(){pledgeList.innerHTML=pledges.map(pl=>`<li class="list-group-item">âœï¸ ${pl.user}: ${pl.pledge}</li>`).join('');}

// ===== Confetti & Sound =====
function confettiEffect(){confetti({particleCount:100,spread:70,origin:{y:0.6}});}
function playChime(){document.getElementById('chime').play();}
</script>

</body>
</html>
